#!/bin/bash

set -e

# replace admin password and secret in test config
pushd test-config/environments/"${ENVIRONMENT_NAME}"
ADMIN_PASSWORD=$(grep cf_admin_password vars-store.yml  | cut -d' ' -f2)
  sed -i -- "s/{{admin-password}}/${ADMIN_PASSWORD}/g" smoke-config.json
popd

ENVIRONMENT_PATH="test-config/environments/${ENVIRONMENT_NAME}/smoke-config.json"
export CONFIG=${PWD}/${CONFIG:-"${ENVIRONMENT_PATH}"}

echo "$CONFIG"

cd cf-app-sd-release
export GOPATH=$PWD

cd src/smoke
export APPS_DIR=../example-apps

# Push App Smoke
ginkgo -r -v --focus="Push App Smoke"
ginkgo -r -v --focus="Delete App Smoke"
